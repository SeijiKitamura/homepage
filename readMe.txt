--------------------------------------------------------
 StorePress 
--------------------------------------------------------

0.はじめに
 当初、WordPressを使用してホームページ製作を試みたが、
 カスタマイズするスキルがなかったため、希望するページを作成する
 ことができなかった。「それならば」と思い、自分である程度のホーム
 ページが表示できるものを作成しようと思ったのがきっかけだった。

 ホームページでもっとも面倒なことは日々の更新なので、この点を
 なるべく簡素化できるよう極力CSVファイルでデータのやりとりを
 行うに設計した。
 （このCSVを作成するエクセルVBAの方が大変だったかも。
 　現在、このExcelについては公開するつもりはありません。）

 セキュリティー面やSEO的にまだまだ改良の余地はあるが、
 とりあえずリリースして、細かい点は追って対応していきたいと
 思っている。

 2013年3月10日

1.ディレクトリ構造

 hp             705   ホームディレクトリ
 |       
 |- js          705   JavaScrip
 | 
 |- css         705   CSS
 |
 |- img         705   画像
 |
 |- php         705   PHP (主にクラス郡）
     |
     |- data    704   データファイル

 ページとして表示するファイルはホームディレクトリに設置。
 それ以外のファイルは各ディレクトリに配置。

2.データの流れ

 1)Excelを使用してCSVファイルを作成
 2)FTPで所定位置にCSVをアップロード
 3)データ更新(/hp/php/update.phpを使用)
 
 実際の運用時には、自動で更新されるようバッチファイル等
 を作成する必要がある。(cron.sh)

3.データとテーブルの関係
 以下のデータファイルはすべて/hp/php/dataディレクトリに配置
 されている。

   ---------------------------------------------------------
     テーブル名  |  CSVファイル名  |  説明
   ---------------------------------------------------------
   pageconfig    |  pageconfing.csv|  各ページのヘッダー
   janmas        |  janmas.csv     |  商品マスタ
   clsmas        |  clsmas.csv     |  クラスマスタ (最下層)
   linmas        |  linmas.csv     |  ラインマスタ (最上層）
   saleitems     |  calendar.csv   |  カレンダー
   同上          |  mailitems.csv  |  メールご案内商品
   同上          |  tirasiitem.csv |  チラシ商品
   同上          |  goyoyaku.csv   |  ご注文商品
 
   saleitemsテーブルには、カレンダー、チラシ、メール商品、
   ご注文商品の4種類のデータが混在して入っている。
   各データには決まった番号が振られていてデータを抽出する際、
   その番号を使用するようになっている。

4.ページ詳細
  index.php      トップページ

  calendar.php   カレンダー
  goyoyaku.php   ご注文商品
  item.php       新商品、既存商品
  mailitem.php   メール商品
  tirasiitem.php チラシ商品

  about.php      会社概要
  enkaku.php     沿革
  kyujin.php     アルバイト求人情報
  map.php        地図

  sinsotu.php    新卒求人
  oitati.php     会社の生い立ち
  saiyo.php      採用方針
  jouken.php     採用条件
  sigoto.php     作業内容
  senpai.php     先輩からの挨拶
  jisseki.php    採用実績
  

5.PHPファイルついて
  1)config.php (設定ファイル)
    DB接続情報、DBのテーブル列情報、パラメータ系定数、
    CSV列情報などが記述されている。
    以下のクラスを使用する際、必ずこのファイルを読み込まなければ
    ならない。
    
  2)db.class.php(DBインターフェイスクラス)
    オリジナルのPDOラッパー。PDOを使用する際、面倒な手続きを
    このラッパーで処理する。また、与えたSQLの結果を自動で
    配列に代入し、配列を返すようにしている。以下、各クラスの
    スーパークラス(親クラス)となっている。
  
  3)janmas.class.php
    単品を返す
  
  4)tirasi.class.php
    チラシ商品を返す

  5)mailist.class
    メール商品を返す
  
  6)goyoyaku.class.php
    ご注文商品を返す
  
  7)page.class.php
    ページ情報を返す
  
  8)html.class.php
    引数に指定のデータを渡すことで定型のHTMLを返す
    (ヘッダー、フッターなど）
  
  9)update.php
    データを更新する際に使用するPHP。これを実行すると、
    CSVファイルを取り込む。したがって、ブラウザでこのページを
    開くだけでデータが更新されるので、更新作業はかなり楽だが
    セキュリティ面を考えるとかなり不安な状態。(不特定多数に
    同時にアクセスされると、ページが表示されない。)
    対策としてパーミッション700にして、cronで対応するのが
    ベストか？今後の検討とする。

 10)import.class.php
    CSVインポートする際に使用するPHP。主にCSVを配列へ格納し
    データを所定のテーブルへインポートするのが役目。

6.その他
